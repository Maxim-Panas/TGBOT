<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–ü–£–¢–¨ –ö–û–†–û–õ–Ø</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html, body {
  margin:0;
  padding:0;
  width:100%;
  height:100%;
}

body{
  font-family:'Cinzel',serif;
  background:radial-gradient(circle at top,#6a1db0,#2a0040,#050008);
  color:#fff;
  height:100vh;
  overflow:hidden;
}
:root{
  --gold:#d6a84a;
  --gold-dark:#8f6a1f;
}
.glow{text-shadow:0 0 8px rgba(180,80,255,.9)}

.screen{
   justify-content:flex-start;
  position:fixed;
  top:0;
  left:0;

  width:100%;
  height:100dvh;   /* üî• –Ω–µ vh */

  display:flex;
  flex-direction:column;
  padding:4vw;

  transform: translateX(100%);
  opacity:0;
  transition: transform .6s ease, opacity .6s ease;

  overflow:hidden;
}

.screen.active{
  transform: translateX(0);
  opacity:1;
  z-index:2;
}


/* ===== MENU ===== */

/* ‚¨áÔ∏è –û–ü–£–°–¢–ò–¢–ò –ö–û–ù–¢–ï–ù–¢ –ú–ï–ù–Æ */
#menu {
  position: relative;
  height: 100vh;           /* –∑–∞–π–º–∞—î –≤–µ—Å—å –µ–∫—Ä–∞–Ω */
  display: flex;
  flex-direction: column;
  justify-content: space-between; /* –≤–µ—Ä—Ö-—Ü–µ–Ω—Ç—Ä-–Ω–∏–∑ */
  padding: 0 2vw;
}


/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä—ñ–≤–Ω—ñ–≤ */
#levels {
  display: flex;
  flex-direction: column;  /* —Å—Ç–æ–≤–ø—á–∏–∫ */
  justify-content: center; /* –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
  align-items: flex-start; /* –ª—ñ–≤–æ—Ä—É—á */
  gap: 1vw;                /* –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ */
  margin-left: 2vw;
  flex: 1;                  /* –∑–∞–π–º–∞—î –≤–µ—Å—å –ø—Ä–æ—Å—Ç—ñ—Ä –º—ñ–∂ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º —ñ –≥–∞–ª–µ—Ä–µ—î—é */
}

/* –ö–≤–∞–¥—Ä–∞—Ç–∏ —Ä—ñ–≤–Ω—ñ–≤ */
.level {
  border: 2px solid var(--gold-dark);
  border-radius: 14px;
  color: var(--gold);
  text-align: center;

  width: 20vw;             
  aspect-ratio: 1;         
  display: flex;
  justify-content: center;
  align-items: center;

  cursor: pointer;
  transition: transform .2s ease, background .2s ease;
}

.level.locked {
  opacity: 0.4;
  cursor: default;
}

.level:hover:not(.locked) {
  transform: scale(1.05);
  background: rgba(214,168,74,0.1);
}

/* –ì–∞–ª–µ—Ä–µ—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ */
#gallery {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 2vw;
  padding: 30vw 0;
}
.slot{
  width:15vw;
  max-width:80px;
  aspect-ratio:1;
  border:2px solid var(--gold-dark);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.slot img{max-width:85%}

/* ===== GAME ===== */
.header{
  position:absolute;
  top:3vh;
  left:4vw;
  right:4vw;
  display:flex;
  justify-content:space-between;
  z-index:20;
}

.attempts{
  border:2px solid var(--gold-dark);
  padding:2vw 4vw;
  border-radius:10px;
  color:var(--gold);
}

.carousel{
  position:absolute;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}


.track{
  position:relative;
  width:100%;
  height:100%;
}


.chest{
  transition:
    transform .7s cubic-bezier(.2,.9,.2,1),
    filter .5s ease,
    opacity .5s ease;
}

.chest.center{
  filter:
    drop-shadow(0 0 35px gold)
    drop-shadow(0 0 70px rgba(255,230,140,.9));
}


@keyframes centerPulse{
  0%,100%{ transform: scale(1.05); }
  50%{ transform: scale(1.15); }
}


@keyframes centerGlow{
  0%,100%{
    filter:
      drop-shadow(0 0 25px gold)
      drop-shadow(0 0 40px gold);
  }
  50%{
    filter:
      drop-shadow(0 0 45px #fff6b0)
      drop-shadow(0 0 70px gold);
  }
}

.chest::after{
  content:'';
  position:absolute;
  bottom:-12%;
  left:50%;
  width:70%;
  height:30%;
  transform:translateX(-50%);
  border-radius:50%;
  background: radial-gradient(circle,
    rgba(255,210,80,.6),
    transparent 70%
  );
  opacity:0;
  transition:.5s;
}

.chest.center::after{
  opacity:1;
}


@keyframes aura{
  0%,100%{ transform:scale(1); opacity:.7 }
  50%{ transform:scale(1.25); opacity:1 }
}


/* –ª—ñ–≤–∏–π */
.chest.left{
  transform:translate(calc(-50% - 26vw),-50%) scale(.9);
  opacity:.7;
  z-index:3;
}

/* –ø—Ä–∞–≤–∏–π */
.chest.right{
  transform:translate(calc(-50% + 26vw),-50%) scale(.9);
  opacity:.7;
  z-index:3;
}

/* –î–ê–õ–ï–ö–ò–ô –õ–Ü–í–ò–ô */
.chest.far-left{
  transform:translate(calc(-50% - 50vw),-50%) scale(.65);
  opacity:.4;
  z-index:1;
}

/* –î–ê–õ–ï–ö–ò–ô –ü–†–ê–í–ò–ô */
.chest.far-right{
  transform:translate(calc(-50% + 50vw),-50%) scale(.65);
  opacity:.4;
  z-index:1;
}

@keyframes centerPulse{
  0%,100%{
    transform:translate(-50%,-50%) scale(1.35);
  }
  50%{
    transform:translate(-50%,-50%) scale(1.42);
  }
}


.chest.opening{
  animation:openChest .6s ease;
}

@keyframes openChest{
  0%{
    transform:translate(-50%,-50%) scale(1.3);
  }
  40%{
    transform:translate(-50%,-50%) scale(1.45);
  }
  100%{
    transform:translate(-50%,-50%) scale(1.3);
  }
}


.chest.active{
  transform:scale(1.25);
  opacity:1;
  filter:drop-shadow(0 0 20px gold);
}

/* ===== OVERLAY ===== */
#overlay{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;

  background: radial-gradient(circle at center,
    rgba(255,230,160,.98),
    rgba(120,0,180,.85),
    rgba(0,0,0,.98)
  );

  z-index:1000;

  /* üî• –æ—Ü–µ –≥–æ–ª–æ–≤–Ω–µ ‚Äî —ñ–≥–Ω–æ—Ä—É—î –≤—Å—ñ transform –µ–∫—Ä–∞–Ω—ñ–≤ */
  transform: none !important;
}


/* scroll for carousel */
.carousel{
  overflow:hidden;
  scroll-snap-type:x mandatory;
}
.track{
  scroll-snap-align:center;
  width:100%;
  overflow:hidden;
}

.chest{
  transform-style: preserve-3d;
  position:absolute;
  top:50%;
  left:50%;
  width:22vw;
  max-width:120px;
  transform:translate(-50%,-50%) scale(.7);
  opacity:.35;
  transition:.45s ease;
}

.chest img{
  width:100%;
  display:block;
  animation: chestGlow 3s infinite ease-in-out;
}

@keyframes chestGlow{
  0%,100%{
    filter: brightness(1);
  }
  50%{
    filter: brightness(1.25);
  }
}


.chest .base{
  position: relative;
  z-index: 1;
  transform: translateZ(0);
}
.chest:not(.center){
  cursor: not-allowed;
  filter: brightness(0.7);
}


.chest .lid{
  position: absolute;
  top: -26%;
  left: 21%;
  width: 62%;

  z-index: 5; /* üî• –í–ê–ñ–õ–ò–í–û */
  transform-origin: bottom center;
  transform: rotateX(0deg) translateZ(2px);
  transition: transform .6s ease;
}


.chest.opening .lid{
  transform: rotateX(75deg) translateZ(2px);
}



.final{
  position:fixed;
  inset:0;
  display:none;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  z-index:30;
}

.final img{
  width:38vw;
  max-width:260px;
  margin-bottom:4vw;
}

/* üëë –ö–û–†–û–ù–ê */
.crown{
  background:
    radial-gradient(circle,rgba(255,220,160,.95),rgba(140,0,200,.8),black);
}

.crown img{
  animation:float 3s ease-in-out infinite;
}

/* üëë‚ú® –ü–û–õ–ù–´–ô –ö–û–†–û–õ–¨ */
.ultimate{
  background:
    radial-gradient(circle at top,#fff6d0,#ffcc66,#6a1db0,black);
}

.ultimate img{
  animation:ascend 4s ease forwards;
}

@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-12px)}
}

@keyframes ascend{
  from{
    transform:scale(.6) translateY(80px);
    opacity:0;
  }
  to{
    transform:scale(1.2) translateY(0);
    opacity:1;
  }
}

/* ‚ú® –§–ï–ô–ï–†–í–ï–†–ö */
.spark{
  position:fixed;
  width:6px;
  height:6px;
  background:gold;
  border-radius:50%;
  animation:boom 1.5s ease-out;
  z-index:40;
}

@keyframes boom{
  from{transform:scale(0);opacity:1}
  to{transform:scale(3);opacity:0}
}

#fireworks{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:50;
}

.slot img,
#overlay img {
  border-radius:50%;
  box-shadow:0 0 15px rgba(255,215,100,.6);
}

/* üì¶ –ó–ë–Ü–õ–¨–®–ï–ù–Ü EMPTY –¢–ê FREE */
#overlay img[src*="empty"],
#overlay img[src*="free"] {
  width: 50vw;
  max-width: 180px;
}

/* –ö–æ—Ä–æ–ª—å –≤–Ω–∏–∑—É –ø—Ä–∞–≤–æ—Ä—É—á –∑ –∞–Ω—ñ–º–∞—Ü—ñ—î—é */
#kingContainer {
  position: absolute;
  bottom: 50vw;
  right: 10vw;
  z-index: 5;
  pointer-events: none;
}

@keyframes kingIdle {
  0%,100% { transform: scale(1) translateY(0); }
  50% { transform: scale(1.05) translateY(-6px); }
}

#kingImg {
  width: 90vw;
  max-width: 180px;
  filter: drop-shadow(0 0 15px gold)
          drop-shadow(0 0 25px gold)
          drop-shadow(0 0 35px gold);
  animation: kingIdle 3s ease-in-out infinite;
}


@keyframes kingEnter {
  from { transform: translateX(150%); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}

@keyframes kingExit {
  from { transform: translateX(0); opacity: 1; }
  to   { transform: translateX(150%); opacity: 0; }
}

.king-exit {
  animation: kingExit 0.8s forwards;
}

.king-enter {
  animation: kingEnter 0.8s forwards;
}





/* –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–∞—Ö–æ–¥—É —ñ –≤–∏—Ö–æ–¥—É –∫–æ—Ä–æ–ª—è */
@keyframes kingEnter {
  0% {
    transform: translateX(150%); /* –ø–æ—á–∏–Ω–∞—î –∑-–∑–∞ –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—é */
    opacity: 0;
  }
  50% {
    transform: translateX(-10%); /* —Ç—Ä–æ—Ö–∏ ‚Äú–ø—Ä–æ—Ö–æ–¥–∏—Ç—å‚Äù –∑–∞ –ø–æ–∑–∏—Ü—ñ—é */
    opacity: 1;
  }
  100% {
    transform: translateX(0); /* –∫—ñ–Ω—Ü–µ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è */
    opacity: 1;
  }
}

@keyframes kingExit {
  0% {
    transform: translateX(0);
    opacity: 1;
  }
  100% {
    transform: translateX(150%); /* –∑–Ω–æ–≤—É –∑‚Äô—ó–∂–¥–∂–∞—î –∑–∞ –ø—Ä–∞–≤–∏–π –∫—Ä–∞–π */
    opacity: 0;
  }
}

@keyframes prizeGlow {
  0%,100% {
    transform: scale(1);
    filter: drop-shadow(0 0 10px gold)
            drop-shadow(0 0 25px gold);
  }
  50% {
    transform: scale(1.08);
    filter: drop-shadow(0 0 25px #fff6b0)
            drop-shadow(0 0 45px gold);
  }
}

@keyframes prizeFloat {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-12px); }
}

#overlay img{
  width: 38vw;
  max-width: 160px;
  min-width: 90px;

  border-radius:50%;
  animation:
    prizeFloat 3s ease-in-out infinite,
    prizeGlow 2.5s ease-in-out infinite;
}


#overlay::before{
  content:'';
  position:absolute;

  width: 70vw;
  height: 70vw;
  max-width: 260px;
  max-height: 260px;

  border-radius:50%;
  background: radial-gradient(circle,
    rgba(255,240,180,.8),
    rgba(255,200,60,.35),
    transparent 70%
  );

  animation: prizeGlow 3s ease-in-out infinite;
}


.continueText{
  margin-top: 6vw;
  font-size: clamp(14px, 4vw, 22px);
  text-align:center;
  padding: 0 6vw;

  color:#fff6b0;
  text-shadow:0 0 10px gold, 0 0 25px gold;
  animation: prizeFloat 2s ease-in-out infinite;
}

@media (max-width: 480px){

  #overlay{
    padding: 6vw;
  }

  #overlay img{
    width: 42vw;
    max-width: 140px;
  }

  #overlay::before{
    width: 80vw;
    height: 80vw;
  }

  .continueText{
    font-size: 16px;
  }
}
#prizeImg{
  z-index: 9999;
}

/* ===== LOADER ===== */
.loaderScreen{
  position:fixed;
  inset:0;
  background: radial-gradient(circle at center,#2a0040,#050008);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:2000;
  opacity:0;
  pointer-events:none;
  transition:.5s;
}

.loaderScreen.active{
  opacity:1;
  pointer-events:auto;
}

.loaderContent{
  text-align:center;
}

.loaderSpinner{
  width:80px;
  height:80px;
  border-radius:50%;
  border:4px solid rgba(255,215,100,.2);
  border-top:4px solid gold;
  animation:spin 1s linear infinite;
  margin:auto;
}

.loaderText{
  margin-top:20px;
  font-size:20px;
  color:var(--gold);
  text-shadow:0 0 10px gold;
  animation:pulse 2s infinite;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

@keyframes pulse{
  0%,100%{opacity:.6}
  50%{opacity:1}
}

.swipeHint{
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;

  background:
    radial-gradient(circle at center,
      rgba(255,215,120,.15),
      rgba(0,0,0,.85)
    );

  backdrop-filter: blur(2px);

  z-index: 5000;

  opacity: 1;
  pointer-events: auto;

  animation: hintFadeIn .6s ease;
}

.swipeHint.hide{
  animation: hintFadeOut .5s ease forwards;
  pointer-events: none;
}

.swipeText{
  margin-top: 14px;
  font-size: 20px;
  font-weight: 700;
  letter-spacing: .5px;
  color: #ffd36a;
  text-shadow:
    0 0 8px rgba(255,211,106,.6),
    0 0 18px rgba(255,170,60,.4);

  animation: swipeGlow 2s ease-in-out infinite;
}

@keyframes hintFadeIn{
  from{opacity:0}
  to{opacity:1}
}

@keyframes hintFadeOut{
  to{opacity:0; transform: scale(1.05)}
}

@keyframes swipeGlow{
  0%,100%{filter: drop-shadow(0 0 6px gold)}
  50%{filter: drop-shadow(0 0 16px orange)}
}

.keys-ui {
  position: fixed;
  top: 16px;
  right: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, #1e1a12, #3a2f1f);
  border: 2px solid #d4af37;
  border-radius: 999px;
  padding: 6px 14px;
  box-shadow: 0 0 15px rgba(212,175,55,0.4);
  font-family: 'Cinzel', serif;
  color: #ffd966;
  font-weight: 700;
  font-size: 18px;
  z-index: 9999;
}

.key-icon {
  width: 28px;
  height: 28px;
  filter: drop-shadow(0 0 6px rgba(255,215,100,0.6));
}

#flyingKey {
  position: fixed;
  width: 36px;
  height: 36px;
  pointer-events: none;
  z-index: 10000;
  opacity: 0;
  transform: scale(0.5);
  transition:
    top 0.6s cubic-bezier(.2,.9,.3,1),
    left 0.6s cubic-bezier(.2,.9,.3,1),
    transform 0.6s ease,
    opacity 0.3s ease;
  filter: drop-shadow(0 0 10px gold);
}
#flyingKey{
  filter:
    drop-shadow(0 0 8px gold)
    drop-shadow(0 0 20px rgba(255,215,100,.8));
}

/* ===== NO KEYS OVERLAY ===== */
.noKeysOverlay{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  background:
    radial-gradient(circle at center,
      rgba(255,220,140,.95),
      rgba(120,0,180,.9),
      rgba(0,0,0,.98)
    );
  z-index:10000;
  animation: fadeIn .4s ease;
}

.noKeysBox{
  background: linear-gradient(135deg,#1a0f05,#3a2610);
  border:3px solid #d6a84a;
  border-radius:22px;
  padding:28px 26px 30px;
  text-align:center;
  box-shadow:
    0 0 25px rgba(255,215,100,.6),
    0 0 60px rgba(255,180,60,.4);
  animation: popIn .45s cubic-bezier(.2,.9,.2,1);
  max-width: 320px;
}

.noKeysIcon{
  width:64px;
  margin-bottom:12px;
  filter:
    drop-shadow(0 0 10px gold)
    drop-shadow(0 0 20px rgba(255,215,100,.8));
  animation: keyPulse 2s infinite;
}

.noKeysBox h2{
  color:#ffd36a;
  margin-bottom:10px;
}

.noKeysBox p{
  color:#fff2c0;
  font-size:16px;
  line-height:1.4;
  margin-bottom:18px;
  text-shadow:0 0 8px rgba(255,215,100,.4);
}

#noKeysBtn{
  background: linear-gradient(135deg,#ffd36a,#b8872f);
  border:none;
  border-radius:999px;
  padding:10px 26px;
  font-family:'Cinzel',serif;
  font-weight:800;
  font-size:16px;
  color:#2a1500;
  cursor:pointer;
  box-shadow:
    0 0 15px rgba(255,215,100,.6);
  transition:.2s;
}

#noKeysBtn:hover{
  transform: scale(1.08);
  box-shadow:0 0 25px gold;
}

@keyframes popIn{
  from{ transform:scale(.6); opacity:0 }
  to{ transform:scale(1); opacity:1 }
}

@keyframes keyPulse{
  0%,100%{ transform:scale(1) }
  50%{ transform:scale(1.12) }
}

.keys-ui{
  flex-direction: column;
  align-items: center;
  padding: 8px 16px 10px;
}

.keys-top{
  display:flex;
  align-items:center;
  gap:8px;
}

.keys-price{
  margin-top: 2px;
  font-size: 13px;
  font-weight: 700;
  color: #ffdf8a;
  text-shadow:
    0 0 6px rgba(255,215,100,.6),
    0 0 12px rgba(255,180,60,.4);
  letter-spacing: .5px;
}

.global-keys-ui{
  z-index: 3000; /* –Ω–∞–¥ —É—Å—ñ–º–∞ –µ–∫—Ä–∞–Ω–∞–º–∏ */
}

/* —Ç—Ä–æ—Ö–∏ –∑–º–µ–Ω—à–∏–º–æ –≤ –º–µ–Ω—é, —â–æ–± –Ω–µ –∑–∞–≤–∞–∂–∞–ª–æ */
#menu .global-keys-ui{
  transform: scale(0.95);
}

/* üîë —Ö–æ–≤–∞—î–º–æ –∫–ª—é—á—ñ, –∫–æ–ª–∏ –∞–∫—Ç–∏–≤–Ω–∏–π loader */
.loaderScreen.active ~ .keys-ui,
body.loading .keys-ui {
  display: none !important;
}

/* üí∞ —Ü—ñ–Ω–∞ —Ç—ñ–ª—å–∫–∏ –≤ –≥—Ä—ñ */
#menu .keys-price {
  display: none;
}


</style>
</head>

<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"></script>

<div id="menuLoader" class="loaderScreen active">
  <div class="loaderContent">
    <div class="loaderSpinner"></div>
    <div class="loaderText">–ü—Ä–æ–±—É–¥–∂–µ–Ω–Ω—è –∫–æ—Ä–æ–ª—è‚Ä¶</div>
  </div>
</div>

<!-- MENU -->
<div id="menu" class="screen active">
  <h2 class="glow" style="text-align:center;color:var(--gold);padding-top: 10vh;">–ü–£–¢–¨ –ö–û–†–û–õ–Ø</h2>

  <div id="kingContainer" style="text-align:right;margin:13vw 0;">
    <img id="kingImg" src="hero0.png" >
  </div>

  <div id="levels"></div>

  <div id="gallery"></div>
</div>

<div id="gameLoader" class="loaderScreen">
  <div class="loaderContent">
    <div class="loaderSpinner"></div>
    <div class="loaderText">–ö–æ–≤–∫–∞ —Å—É–Ω–¥—É–∫–æ–≤‚Ä¶</div>
  </div>
</div>

<div class="keys-ui">
  <div class="keys-top">
    <img src="key.png" class="key-icon">
    <span id="keysCount">100</span>
  </div>
  <div class="keys-price" id="keysPrice">
    –¶e–Ω–∞: 1 üîë
  </div>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div class="header">
    <div id="levelTitle" class="glow"></div>
  </div>

<div id="swipeHint" class="swipeHint">
  <div id="swipeLottie" style="width:220px;height:220px"></div>
 <div class="swipeText">–ü—Ä–æ–≤–µ–¥–∏, —á—Ç–æ–±—ã –ª–∏—Å—Ç–∞—Ç—å —Å—É–Ω–¥—É–∫–∏</div>
</div>




<img src="key.png" id="flyingKey">


  <div class="carousel">
    <div class="track" id="track"></div>
  </div>
</div>

<!-- PRIZE -->
<div id="overlay">
  <img id="prizeImg">
  <div class="continueText">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
</div>

<div id="crownWin" class="final crown" style="display:none;flex-direction:column;justify-content:center;align-items:center;z-index:1000;">
  <img src="king_full.png" style="width:38vw;max-width:160px;margin-bottom:4vw;">
  <h1 class="glow">–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!</h1>
  <p>–í—ã —Å—Ç–∞–ª–∏ –∫–æ—Ä–æ–ª–µ–º!</p>
</div>


<canvas id="fireworks"></canvas>

<!-- NO KEYS OVERLAY -->
<div id="noKeysOverlay" class="noKeysOverlay">
  <div class="noKeysBox">
    <img src="key.png" class="noKeysIcon">
    <h2 class="glow">–ö–ª—é—á–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å</h2>
<p>–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ —Å—É–Ω–¥—É–∫–∏ –∑–∞–ø–µ—Ä—Ç—ã‚Ä¶</p>
<button id="noKeysBtn">–ü–æ–Ω—è—Ç–Ω–æ</button>

  </div>
</div>


<script>
let chestRewards = []; // –Ω–∞–≥–æ—Ä–æ–¥–∏ —Å—É–Ω–¥—É–∫—ñ–≤ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
let artifactFound = false;
let hintActive = true;
const swipeHint = document.getElementById('swipeHint');
['click','touchstart','touchend'].forEach(evt=>{
  swipeHint.addEventListener(evt, ()=>{
    if(hintActive){
      hideSwipeHint();
    }
  });
});



const artifacts=[
  "11.png",
  "12.png",
  "13.png",
  "14.png",
  "15.png" // üëë –∫–æ—Ä–æ–Ω–∞
];

let collected=[];
let levels=Array(5).fill(false);
let current=0, active=2, locked=false;
let unlockedLevel = 0; // —ñ–Ω–¥–µ–∫—Å, 0 = –¥–æ—Å—Ç—É–ø–Ω–∏–π —Ç—ñ–ª—å–∫–∏ 1 —Ä—ñ–≤–µ–Ω—å



const openedChests = new Set();

const menu=document.getElementById('menu');
const game=document.getElementById('game');
const track=document.getElementById('track');
const overlay=document.getElementById('overlay');
const noKeysOverlay = document.getElementById('noKeysOverlay');
const noKeysBtn = document.getElementById('noKeysBtn');

noKeysBtn.onclick = () => {
  noKeysOverlay.style.display = 'none';
};


function renderMenu(){
  levelsBox.innerHTML='';
  levels.forEach((done,i)=>{
    const d=document.createElement('div');
    d.className='level'+(done?' locked':'');
    d.textContent='–£—Ä–æ–≤–µ–Ω—å '+(i+1);
    if(!done) d.onclick=()=>startLevel(i);
    levelsBox.appendChild(d);
  });
  renderGallery();
}

function startLevel(i){
  current=i;
  artifactFound=false;

  generateRewards();

  levelTitle.textContent='–£—Ä–æ–≤–µ–Ω—å '+(i+1);
  renderChests();
  updateKeysPrice();
  switchScreen(menu,game);
}

function chestCost(){
  return current + 1; // 1 —Ä—ñ–≤–µ–Ω—å = 1 –∫–ª—é—á, 2 = 2 ...
}

const allImages = [
  // –∫–æ—Ä–æ–ª—ñ
  "hero0.png","hero1.png","hero2.png","hero3.png","hero4.png","hero5.png",
  "king_full.png",

  // —Å—É–Ω–¥—É–∫–∏
  "Case.png","lid.png","empty.png","free.png",

  // –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏
  ...artifacts
];

function preloadImages(list){
  return Promise.all(
    list.map(src=>{
      return new Promise(res=>{
        const img = new Image();
        img.src = src;
        img.onload = res;
        img.onerror = res;
      });
    })
  );
}


function generateRewards(){
  chestRewards = [
    'artifact',
    'free',
    'empty',
    'empty',
    'empty'
  ];

  // –ø–µ—Ä–µ–º—ñ—à—É—î–º–æ –º–∞—Å–∏–≤
  for(let i=chestRewards.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [chestRewards[i], chestRewards[j]] =
    [chestRewards[j], chestRewards[i]];
  }
}


function renderChests(){
  track.innerHTML='';

  for(let i=0;i<5;i++){
    const chest = document.createElement('div');
    chest.className = 'chest';
    chest.dataset.index = i;

    // ‚úÖ –ø–µ—Ä–µ–¥–∞—î–º–æ —Ä–µ–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
    chest.onclick = () => openChest(i);

    chest.innerHTML = `
      <img src="Case.png" class="base">
      <img src="lid.png" class="lid">
    `;

    track.appendChild(chest);
  }

  updateCarousel();
}

function hideSwipeHint(){
  hintActive = false;
  swipeHint.classList.add('hide');

  // üî• –∑–Ω–∏—â—É—î–º–æ Lottie
  if(swipeAnimation){
    swipeAnimation.destroy();
    swipeAnimation = null;
  }

  setTimeout(()=>{
    swipeHint.style.display = 'none';
  }, 500);
}





function openChest(index){

  if (locked) return; // üîí –ë–õ–û–ö –æ–¥—Ä–∞–∑—É
  locked = true;      // üîí —Å—Ç–∞–≤–∏–º–æ –º–∏—Ç—Ç—î–≤–æ

  if(hintActive){
    hideSwipeHint();
  }

  const cost = chestCost();

  if (keys < cost) {
    locked = false; // ‚ùó –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ, –±–æ –Ω–µ –≤—ñ–¥–∫—Ä–∏–ª–∏
    noKeysOverlay.style.display = 'flex';
    vibrate([120, 60, 120]);
    return;
  }

  if (openedChests.has(index)) {
    locked = false;
    return;
  }

  const chest = document.querySelector(`.chest[data-index="${index}"]`);

  useKeyAndOpenChest(chest, () => {

    chest.classList.add('opening');

    setTimeout(()=>{

      openedChests.add(index);
      showPrize(index);

      // ‚ùå –ù–ï unlock —Ç—É—Ç ‚Äî —Ü–µ —Ä–æ–±–∏—Ç—å—Å—è –ø—ñ—Å–ª—è overlay

    }, 600);

  });
}







function vibrate(pattern = [200, 100, 200]){
  if (navigator.vibrate) {
    navigator.vibrate(pattern);
    
  }
}


function showPrize(openedIndex){

  let reward = chestRewards[openedIndex];


  overlay.style.display = 'flex';
  locked = true;

  if(reward === 'artifact'){
    let prize = artifacts[current];
    // üîì –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–≤–µ–Ω—å
if (current === unlockedLevel && unlockedLevel < levels.length - 1) {
  unlockedLevel++;
}


    if(!collected.includes(prize)){
      collected.push(prize);
    }

    prizeImg.src = prize;
    artifactFound = true;
    levels[current] = true;

    launchFireworks(40);
    explode(Math.random()*canvas.width, Math.random()*canvas.height*0.5, 180);
    vibrate([150, 80, 150, 80, 300]);

    overlay.onclick = () => {
      overlay.style.display = 'none';

      // üî• —Å—É–Ω–¥—É–∫ —Å—Ç–∞—î —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–º –ü–Ü–°–õ–Ø –ø—Ä–∏–∑—É
      active = openedIndex;
      updateCarousel();

      locked = false;

      if(prize === "15.png") {
        megaFireworks();
        showCrownWin();
        return;
      }

      if(collected.length === artifacts.length) {
        megaFireworks();
        showUltimateWin();
        return;
      }

      switchScreen(game, menu);
      renderMenu();
    };

  }
  else if(reward === 'free'){
    // üîë FREE = +1 –∫–ª—é—á
    keys++;
    keysCountEl.textContent = keys;
    updateKeysPrice();

    prizeImg.src = 'free.png';

    overlay.onclick = () => {
      overlay.style.display = 'none';

      active = openedIndex;
      updateCarousel();

      locked = false;
    };
  }
  else if(reward === 'empty'){
    prizeImg.src = 'empty.png';

    overlay.onclick = () => {
      overlay.style.display = 'none';

      active = openedIndex;
      updateCarousel();

      locked = false;

      switchScreen(game, menu);
      renderMenu();
    };
  }
}



function updateCarousel(){

  const positions = [
    { x:-44, y:10, scale:.7, rotate:-18, opacity:.5, glow:0 },
    { x:-22, y:4,  scale:.85, rotate:-8, opacity:.8, glow:0 },
    { x:0,   y:0,  scale:1.2, rotate:0,  opacity:1, glow:1 },
    { x:22,  y:4,  scale:.85, rotate:8,  opacity:.8, glow:0 },
    { x:44,  y:10, scale:.7, rotate:18, opacity:.5, glow:0 }
  ];

  document.querySelectorAll('.chest').forEach((c,i)=>{

    let posIndex = (i - active + 5) % 5;
    let p = positions[posIndex];

    c.style.transform = `
      translate(-50%, -50%)
      translateX(${p.x}vw)
      translateY(${p.y}vw)
      scale(${p.scale})
      rotate(${p.rotate}deg)
    `;

    c.style.opacity = p.opacity;
    c.style.zIndex = 10 - Math.abs(2 - posIndex);

    // glow –ø–ª–∞–≤–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—î—Ç—å—Å—è
    if(p.glow){
      c.classList.add('center');
    } else {
      c.classList.remove('center');
    }
updateKeysPrice();

  });
}



vibrate([20]);




function renderGallery(){
  gallery.innerHTML='';
  artifacts.forEach(a=>{
    const s=document.createElement('div');
    s.className='slot';
    if(collected.includes(a)){
      const i=document.createElement('img');
      i.src=a;
      s.appendChild(i);
    }
    gallery.appendChild(s);
  });
}

let startX = 0;

track.addEventListener('touchstart',e=>{
  startX = e.touches[0].clientX;
});

track.addEventListener('touchend',e=>{
  if(hintActive){
  hideSwipeHint();
}
  let dx = e.changedTouches[0].clientX - startX;

  if(Math.abs(dx) < 40) return;

  if(dx < 0){
    active = (active + 1) % 5;
  } else {
    active = (active + 4) % 5;
  }

  updateCarousel();
});




function switchScreen(from, to){
  const priceEl = document.getElementById('keysPrice');

// —è–∫—â–æ –π–¥–µ–º–æ –≤ –≥—Ä—É ‚Äî –ø–æ–∫–∞–∑—É—î–º–æ —Ü—ñ–Ω—É
if (to.id === 'game') {
  priceEl.style.display = 'block';
} else {
  // —è–∫—â–æ –º–µ–Ω—é –∞–±–æ —ñ–Ω—à–µ ‚Äî —Ö–æ–≤–∞—î–º–æ
  priceEl.style.display = 'none';
}


  // 1Ô∏è‚É£ –º–µ–Ω—é —ó–¥–µ –≤–ª—ñ–≤–æ
  from.style.transform = 'translateX(-100%)';

  // —á–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
  setTimeout(()=>{

    from.classList.remove('active');

    // 2Ô∏è‚É£ –≥–æ—Ç—É—î–º–æ –Ω–æ–≤–∏–π –µ–∫—Ä–∞–Ω —Å–ø—Ä–∞–≤–∞
    to.style.transform = 'translateX(100%)';
    to.classList.add('active');

    // 3Ô∏è‚É£ –∑–∞–ø—É—Å–∫–∞—î–º–æ –∑–∞—ó–∑–¥
    requestAnimationFrame(()=>{
      to.style.transform = 'translateX(0)';
    });

  }, 600); // = transition .6s
}


const levelsBox=document.getElementById('levels');
const levelTitle=document.getElementById('levelTitle');


function launchFireworks(count=40){
  for(let i=0;i<count;i++){
    const s=document.createElement('div');
    s.className='spark';
    s.style.left=Math.random()*100+'vw';
    s.style.top=Math.random()*100+'vh';
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),1500);
  }
}

function showCrownWin(){
  const win=document.getElementById('crownWin');
  win.style.display='flex';
  launchFireworks(30);

  win.onclick=()=>{
    win.style.display='none';
    switchScreen(game,menu);
    renderMenu();
  };
}

function showUltimateWin(){
  const win=document.getElementById('ultimateWin');
  win.style.display='flex';
  launchFireworks(70);

  win.onclick=()=>{
    win.style.display='none';
    switchScreen(game,menu);
    renderMenu();
  };
}

const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resizeCanvas();
addEventListener("resize", resizeCanvas);

let particles=[];

function explode(x,y,count=120){
  for(let i=0;i<count;i++){
    particles.push({
      x,y,
      r:Math.random()*3+1,
      a:Math.random()*Math.PI*2,
      s:Math.random()*6+2,
      l:100,
      c:`hsl(${Math.random()*360},100%,60%)`
    });
  }
}

function fireworksLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach((p,i)=>{
    p.x+=Math.cos(p.a)*p.s;
    p.y+=Math.sin(p.a)*p.s;
    p.l--;
    ctx.fillStyle=p.c;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
    if(p.l<=0) particles.splice(i,1);
  });
  requestAnimationFrame(fireworksLoop);
}
fireworksLoop();

function megaFireworks(){
  let bursts=0;
  let interval=setInterval(()=>{
    explode(
      Math.random()*canvas.width,
      Math.random()*canvas.height*0.6,
      160
    );
    bursts++;
    if(bursts>8) clearInterval(interval);
  },300);
}

const kings = [
  "hero0.png", // —Å—Ç–∞—Ä—Ç–æ–≤–∏–π
  "hero1.png",
  "hero2.png",
  "hero3.png",
  "hero4.png",
  "hero5.png"
];

function updateKing() {
  let passed = levels.filter(l => l).length;
  let newSrc = kings[passed];
  let king = document.getElementById('kingImg');

  if (king.src.includes(newSrc)) return;

  changeKing(newSrc);
}



function renderMenu(){
  levelsBox.innerHTML = '';

  levels.forEach((done, i) => {
    const d = document.createElement('div');
    d.textContent = '–£—Ä–æ–≤–µ–Ω—å ' + (i + 1);

    if (i > unlockedLevel) {
      // üîí —â–µ –∑–∞–∫—Ä–∏—Ç–∏–π
      d.className = 'level locked';
    } else {
      // ‚úÖ –¥–æ—Å—Ç—É–ø–Ω–∏–π
      d.className = 'level';
      d.onclick = () => startLevel(i);
    }

    levelsBox.appendChild(d);
  });

  renderGallery();
  updateKing();
}


function changeKing(newSrc) {
  const king = document.getElementById('kingContainer');
  const img = document.getElementById('kingImg');

  king.classList.add('king-exit');

  king.addEventListener('animationend', function handleExit() {
    king.removeEventListener('animationend', handleExit);
    king.classList.remove('king-exit');

    img.src = newSrc;

    king.classList.add('king-enter');

    king.addEventListener('animationend', function handleEnter() {
      king.removeEventListener('animationend', handleEnter);
      king.classList.remove('king-enter');
    });
  });
}

function startLevel(i){
  current = i;
  artifactFound = false;
  openedChests.clear();

  const gameLoader = document.getElementById('gameLoader');
  gameLoader.classList.add('active');
  document.body.classList.add('loading');


  preloadImages(["Case.png","lid.png"]).then(()=>{

  generateRewards();
  levelTitle.textContent = '–£—Ä–æ–≤–µ–Ω—å ' + (i + 1);
  renderChests();

  gameLoader.classList.remove('active');
document.body.classList.remove('loading');
switchScreen(menu, game);


  // üî• –ø–æ–∫–∞–∑—É—î–º–æ –ø—ñ–¥–∫–∞–∑–∫—É
  hintActive = true;
  swipeHint.style.display = 'flex';
  swipeHint.classList.remove('hide');

  // üî• –ó–ê–ü–£–°–ö LOTTIE
  setTimeout(startSwipeHint, 300);

});

}



const menuLoader = document.getElementById('menuLoader');

menu.classList.remove('active');

document.body.classList.add('loading'); // üîë —Ö–æ–≤–∞—î–º–æ –∫–ª—é—á—ñ
menuLoader.classList.add('active');

preloadImages(allImages).then(()=>{
  menuLoader.classList.remove('active');
  document.body.classList.remove('loading'); // üîë –ø–æ–∫–∞–∑—É—î–º–æ –∫–ª—é—á—ñ
  menu.classList.add('active');
  renderMenu();
});


let keys = 100;
const keysCountEl = document.getElementById('keysCount');
document.getElementById('keysPrice').style.display = 'none';

const flyingKey = document.getElementById('flyingKey');

function useKeyAndOpenChest(chestEl, callback){

  const cost = chestCost();
if (keys < cost) {

  noKeysOverlay.style.display = 'flex';
  vibrate([100,50,100]);
  return;
}


keys -= cost;
keysCountEl.textContent = keys;
updateKeysPrice();

  const uiKey = document.querySelector('.key-icon').getBoundingClientRect();
  const chestRect = chestEl.getBoundingClientRect();

  flyingKey.style.left = uiKey.left + 'px';
  flyingKey.style.top = uiKey.top + 'px';
  flyingKey.style.opacity = '1';
  flyingKey.style.transform = 'scale(1) rotate(0deg)';

  setTimeout(()=>{

    flyingKey.style.left = (chestRect.left + chestRect.width * 0.55) + 'px';
    flyingKey.style.top  = (chestRect.top  + chestRect.height * 0.45) + 'px';
    flyingKey.style.transform = 'scale(0.9) rotate(110deg)';

  }, 50);

  // –Ω—ñ–±–∏ –∫–ª—é—á –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –∑–∞–º–æ–∫
  setTimeout(()=>{

    flyingKey.style.transform = 'scale(0.2) rotate(160deg)';
    flyingKey.style.opacity = '0';

    callback();

  }, 650);
}


function updateKeysPrice(){
  const priceEl = document.getElementById('keysPrice');
  priceEl.textContent = `–¶—ñ–Ω–∞: ${chestCost()} üîë`;
}

let swipeAnimation;

function startSwipeHint(){

  if(swipeAnimation) return; // —â–æ–± –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –¥–≤—ñ—á—ñ

  swipeAnimation = lottie.loadAnimation({
    container: document.getElementById('swipeLottie'),
    renderer: 'svg',
    loop: true,
    autoplay: true,
    path: 'swipe-left.json'
  });

}

</script>

</body>
</html>
 


